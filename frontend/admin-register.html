<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin â€” Registrarse</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { background:#0f1724; color:#e6eef8; display:flex; align-items:center; justify-content:center; height:100vh; font-family:Inter,system-ui; }
    .card { width:420px; padding:1.25rem; border-radius:12px; background:#071029; }
    .small-muted { color:#9fb0c8; font-size:.9rem; }
  </style>
</head>

<body>
  <div class="card">
    <h4>Registrar Admin</h4>
    <p class="small-muted">Crear cuenta de administrador.</p>
    <div id="alertArea"></div>

    <form id="regForm">
      <div class="mb-2"><input id="name" class="form-control" placeholder="Nombre" required></div>
      <div class="mb-2"><input id="email" type="email" class="form-control" placeholder="Email" required></div>
      <div class="mb-2"><input id="password" type="password" class="form-control" placeholder="Password" required></div>

      <div class="d-flex gap-2">
        <button class="btn btn-primary w-100" type="submit">Registrar</button>
        <a href="admin-login.html" class="btn btn-outline-light">Login</a>
      </div>
    </form>
  </div>

<script type="module">

/* ===== IMPORTS MODULARES ===== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { 
  getAuth, 
  createUserWithEmailAndPassword 
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { 
  getDatabase, 
  ref, 
  set 
} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

/* ===== CONFIG ===== */
const firebaseConfig = {
  apiKey: "AIzaSyA24_ilRt5u7BDJA7SfQFdUvTvA1_X6CM8",
  authDomain: "control-de-seguridad-b4fa7.firebaseapp.com",
  databaseURL: "https://control-de-seguridad-b4fa7-default-rtdb.firebaseio.com",
  projectId: "control-de-seguridad-b4fa7",
  storageBucket: "control-de-seguridad-b4fa7.firebasestorage.app",
  messagingSenderId: "183262067576",
  appId: "1:183262067576:web:285b6b69b198e58adbe68d"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

/* ===== UTIL ===== */
function toast(msg, level='info'){
  const a = document.getElementById('alertArea');
  a.innerHTML = `<div class="alert alert-${level} p-2">${msg}</div>`;
  setTimeout(()=> a.innerHTML = '', 3500);
}

/* ===== REGISTER ===== */
document.getElementById('regForm').addEventListener('submit', async (ev) => {
  ev.preventDefault();

  const name = document.getElementById('name').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;

  if (!name || !email || !password)
    return toast('Completa todos los campos','warning');

  try {
    const userCred = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCred.user;

    await set(ref(db, `admins/${user.uid}`), {
      name,
      email,
      role: "admin",
      createdAt: Date.now()
    });

    toast('Admin creado correctamente', 'success');

    setTimeout(()=> {
      window.location.href = "admin-login.html";
    }, 1200);

  } catch (err) {
    console.error(err);
    toast(err.message, 'danger');
  }
});

</script>
</body>
</html>
